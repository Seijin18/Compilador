#include "funcs.h"
#include <stdio.h>
#include <stdlib.h>

int main()
{
    Bloco *buffer;
    allocate_buffer(&buffer);
    Lexema *lex;
    allocate_lexema(&lex);
    FILE *fp;
    fp = fopen("teste.txt", "r");
    char c;
    int flag = 1;
    int tabela[29][19] = {
        { 3, 1, 4, 5, 6, 7, 8,22,21,15,16,19,20,17,18,12,11,21,28},
        {28, 1,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28},
        { 2, 2,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28},
        { 3, 2,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28},
        {28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28},
        {28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28},
        {28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28},
        {28,28,28,28,23,28,28,28,28,28,28,28,28,28,28,28,28,28,28},
        {28,28,28,28,28,28, 9,28,28,28,28,28,28,28,28,28,28,28,28},
        {28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28},
        {28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28},
        {28,28,28,28,28,28,13,28,28,28,28,28,28,28,28,28,28,28,28},
        {28,28,28,28,28,28,14,28,28,28,28,28,28,28,28,28,28,28,28},
        {28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28},
        {28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28},
        {28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28},
        {28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28},
        {28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28},
        {28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28},
        {28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28},
        {28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28},
        {28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28},
        {28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28},
        {23,23,23,23,26,27,23,23,23,23,23,23,23,23,23,23,23,23,28},
        {28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28},
        {23,23,23,23,23,26,23,23,23,23,23,23,23,23,23,23,23,23,28},
        {28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28},
        {23,23,23,23,28,23,23,23,23,23,23,23,23,23,23,23,23,23,28},
        {28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28}};

    while (flag > 0)
    {
        flag = get_next_lexema_tabela(lex, buffer, fp, tabela);

        printf("Token: %s\n", lex->token);
        printf("Lexema: %s\n", lex->item);
        printf("Linha: %d\n", lex->line);
        printf("\n");

        if (flag == 0)
        {
            printf("Erro lexico na linha %d\n", lex->line);
            return 0;
        }
        else if (flag == -1)
        {
            printf("Fim do arquivo %d\n", lex->line);
            return 0;
        }
    }
    get_next_lexema_tabela(lex, buffer, fp, tabela);
    printf("Token: %s\n", lex->token);
    printf("Lexema: %s\n", lex->item);
    printf("Linha: %d\n", lex->line);

    return 0;
}
